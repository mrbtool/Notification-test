<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Push Test</title>

  <link rel="manifest" href="manifest.json" />
</head>

<body style="text-align:center;font-family:sans-serif;margin-top:60px">

<h2>ðŸš€ Cloudflare Push Test</h2>

<button onclick="enablePush()">Enable Notifications</button>
<br><br>
<button onclick="sendPush()">Send To All Devices</button>

<script>
const WORKER_URL = "https://YOUR-WORKER.workers.dev"; // change later

async function enablePush() {
  if (!("serviceWorker" in navigator)) return alert("Not supported");

  const reg = await navigator.serviceWorker.register("/sw.js");

  const permission = await Notification.requestPermission();
  if (permission !== "granted") return alert("Permission denied");

  const sub = await reg.pushManager.subscribe({
    userVisibleOnly: true,
    applicationServerKey: urlBase64ToUint8Array("YOUR_PUBLIC_VAPID_KEY")
  });

  await fetch(WORKER_URL + "/subscribe", {
    method: "POST",
    body: JSON.stringify(sub)
  });

  alert("Subscribed successfully âœ…");
}

async function sendPush() {
  await fetch(WORKER_URL + "/send", { method: "POST" });
  alert("Sent to all devices ðŸš€");
}

function urlBase64ToUint8Array(base64String) {
  const padding = '='.repeat((4 - base64String.length % 4) % 4);
  const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
  const rawData = atob(base64);
  return Uint8Array.from([...rawData].map(c => c.charCodeAt(0)));
}
</script>

</body>
</html>
