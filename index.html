<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Push Test</title>

  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#000000" />
</head>

<body style="font-family:sans-serif;text-align:center;margin-top:80px">

  <h1>ðŸš€ Cloudflare Push Test</h1>

  <button id="enableBtn" style="padding:15px 30px;margin:10px;font-size:18px">
    Enable Notifications
  </button>

  <button id="testBtn" style="padding:15px 30px;margin:10px;font-size:18px">
    Send Test Notification
  </button>

<script>
let registration = null;

/* ======================
   Register Service Worker
====================== */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/sw.js")
    .then(reg => {
      registration = reg;
      console.log("SW ready");
    });
}

/* ======================
   Enable Notifications
====================== */
document.getElementById("enableBtn").onclick = async () => {

  if (!("Notification" in window)) {
    alert("Not supported");
    return;
  }

  const permission = await Notification.requestPermission();

  if (permission !== "granted") {
    alert("Permission denied");
    return;
  }

  alert("âœ… Notifications enabled!");
};


/* ======================
   Send Local Test Push
   (works even offline)
====================== */
document.getElementById("testBtn").onclick = async () => {

  if (!registration) {
    alert("Service worker not ready");
    return;
  }

  registration.showNotification("ðŸŽ‰ Test Notification", {
    body: "Background push working!",
    icon: "/icon-192.png"
  });
};
</script>

</body>
</html>
